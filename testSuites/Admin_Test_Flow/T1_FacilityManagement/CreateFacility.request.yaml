id: 5bfb1e55-304c-4e43-b6d4-9070c12db5b3
name: CreateFacility
request:
  url:
    raw: >-
      {{API_Base_URL}}/project/{{PROJECT_ID}}/system/{{SYSTEM_ID}}/srv/prosightApiServer/hospital
    host:
    - '{{API_Base_URL}}'
    path:
    - project
    - '{{PROJECT_ID}}'
    - system
    - '{{SYSTEM_ID}}'
    - srv
    - prosightApiServer
    - hospital
  method: POST
  headers:
  - key: sec-ch-ua-platform
    value: '"macOS"'
  - key: Referer
    value: https://staging-commercial-cox-health.firebaseapp.com/
  - key: sec-ch-ua
    value: '"Google Chrome";v="141", "Not?A_Brand";v="8", "Chromium";v="141"'
  - key: sec-ch-ua-mobile
    value: '?0'
  - key: User-Agent
    value: >-
      Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36
  - key: Accept
    value: application/json
  - key: Content-Type
    value: application/json
  body:
    mode: raw
    modeOfBody: JSON
    raw: |-
      {
      "name": "{{hospitalDetails.hospitalName}}",
      "data": {
          "name": "{{hospitalDetails.hospitalName}}",
          "address": {
              "street": "{{hospitalDetails.streetAddress}}",
              "city": "{{hospitalDetails.city}}",
              "state": "{{hospitalDetails.state}}",
              "zipCode": "{{hospitalDetails.zipCode}}"
          },
          "contact": {},
          "hospitalType": "Default",
          "timezone": "{{hospitalDetails.timezone}}",
          "position": {
              "lat": 42.32694,
              "lon": -71.83355
          }
      },
      "metadata": {
          "timeZone": "{{hospitalDetails.timezone}}",
          "allowedApplications": [
              "Prosight Assets",
              "Prosight Safety",
              "Prosight Environment"
              ]
          },
          "hasHIDTags": true
      }
  auth:
    type: bearer
    bearer:
      token: '{{idToken}}'
events:
- listen: test
  script:
    type: javascript
    exec:
    - let response = pq.response.json();
    - if (pq.response.code === 201) {
    - '  const hospitalDetails = pq.environment.get("hospitalDetails");'
    - '  pq.test("Validate hospital details", function () {'
    - '    pq.expect(response.name).to.equal(hospitalDetails.hospitalName);'
    - '    pq.expect(response.data.name).to.equal(hospitalDetails.hospitalName);'
    - '    pq.expect(response.data.address.street).to.equal(hospitalDetails.streetAddress);'
    - '    pq.expect(response.data.address.city).to.equal(hospitalDetails.city);'
    - '    pq.expect(response.data.address.state).to.equal(hospitalDetails.state);'
    - '    pq.expect(response.data.address.zipCode).to.equal(hospitalDetails.zipCode);'
    - '    pq.expect(response.data.timezone).to.equal(hospitalDetails.timezone);'
    - '    pq.expect(response.metadata.timeZone).to.equal(hospitalDetails.timezone);'
    - '  });'
    - '  pq.environment.set("HospitalId", response.id);'
    - '} else {'
    - '  console.log(pq.environment.get(''hospitalDetails'').hospitalName);'
    - '  console.log("Hospital creation failed with status code: " + pq.response.code);'
    - '  console.log(response);'
    - '}'
    - ''
type: request
