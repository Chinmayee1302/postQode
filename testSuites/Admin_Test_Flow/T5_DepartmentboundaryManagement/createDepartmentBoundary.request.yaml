id: 7d626ab7-331c-4d0f-8559-db24ca49e60c
name: createDepartmentBoundary
request:
  url:
    raw: >-
      {{API_Base_URL}}/interface/{{SYSTEM_ID}}/hospital/{{HospitalId}}/departmentBoundaries
    host:
      - '{{API_Base_URL}}'
    path:
      - interface
      - '{{SYSTEM_ID}}'
      - hospital
      - '{{HospitalId}}'
      - departmentBoundaries
  method: POST
  headers:
    - description: ''
      disabled: false
      key: Cache-Control
      value: no-cache
    - description: ''
      disabled: false
      key: Accept
      value: '*/*'
    - description: ''
      disabled: false
      key: Accept-Encoding
      value: gzip, deflate
    - description: ''
      disabled: false
      key: Connection
      value: keep-alive
  body:
    mode: raw
    modeOfBody: JSON
    raw: |-
      {
          "data": {
                      "name": "{{updatedDepartmentBoundaryName}}",
                      "department": "{{departmentID}}",
                      "geoJson":
                        {"id":"a2dd22503517ebc198b2269e5e9d85f8","type":"Feature","properties":{},"geometry":{"coordinates":[[[-117.25647114811176,32.991763406312586],[-117.25676101003815,32.99226541524463],[-117.25721916658418,32.99173009673808],[-117.25647114811176,32.991763406312586]]],"type":"Polygon"}}
                    },
                    "name": "{{updatedDepartmentBoundaryName}}"
      }
  auth:
    type: bearer
    bearer:
      token: '{{idToken}}'
events:
  - listen: test
    script:
      type: javascript
      exec:
        - let response = pq.response.json();
        - pq.environment.set('departmentBoundaryId', response.id);
        - const deptBoundId = pq.environment.get('departmentBoundaryId');
        - const baseUrl = pq.environment.get('API_Base_URL');
        - const sysId = pq.environment.get('SYSTEM_ID');
        - const hospId = pq.environment.get('HospitalId');
        - const idToken = pq.globals.get("idToken");
        - const deptId = pq.environment.get('departmentID');
        - const floorId = pq.environment.get('floorId');
        - const request1 = {
        - '    url: `${baseUrl}/interface/${sysId}/hospital/${hospId}/departmentBoundaries/${deptBoundId}?test=true`,'
        - '    method: ''PATCH'','
        - '    header: {'
        - '        ''Cache-Control'': ''no-cache'','
        - '        ''Accept'': ''*/*'','
        - '        ''Accept-Encoding'': ''gzip, deflate'','
        - '        ''Connection'': ''keep-alive'''
        - '    },'
        - '    auth: {'
        - '        type: ''bearer'','
        - '        bearer: {'
        - '            token: idToken'
        - '        }'
        - '    }'
        - '};'
        - pq.sendRequest(request1, function(err, res) {
        - '    console.log(''Response from first embedded request:'', res.json());'
        - '});'
        - ''
        - >-
          let url1 =
          `${baseUrl}/interface/${sysId}/hospital/${hospId}/departments/${deptId}/departmentBoundaries`;
        - console.log(url1);
        - const request2 = {
        - '    url: `${baseUrl}/interface/${sysId}/hospital/${hospId}/departments/${deptId}/departmentBoundaries`,'
        - '    method: ''POST'','
        - '    header: {'
        - '        ''Content-Type'': ''application/json'''
        - '    },'
        - '    body: {'
        - '        mode: ''raw'','
        - '        modeOfBody: ''JSON'','
        - '        raw: JSON.stringify({'
        - '            id: deptBoundId,'
        - '            force: true'
        - '        })'
        - '    },'
        - '    auth: {'
        - '        type: ''bearer'','
        - '        bearer: {'
        - '            token: idToken'
        - '        }'
        - '    }'
        - '};'
        - ''
        - console.log("Request body for request2:", request2.body.raw);
        - pq.sendRequest(request2, (err, res) => {
        - '    if (err) {'
        - '        console.error(err);'
        - '    }'
        - '  console.log(''Response from second embedded request:'', res);'
        - '    console.log(pq.request.body)'
        - '});'
        - ''
        - ''
        - ''
        - const request3 = {
        - '    url: `${baseUrl}/interface/${sysId}/hospital/${hospId}/floors/${floorId}/departmentBoundaries`,'
        - '    method: ''POST'','
        - '    header: {'
        - '        ''Content-Type'': ''application/json'''
        - '    },'
        - '    body: {'
        - '        mode: ''raw'','
        - '        modeOfBody: ''JSON'','
        - '        raw: JSON.stringify({'
        - '            id: deptBoundId,'
        - '            force: true'
        - '        })'
        - '    },'
        - '    auth: {'
        - '        type: ''bearer'','
        - '        bearer: {'
        - '          token: idToken'
        - '        }'
        - '    }'
        - '};'
        - pq.sendRequest(request3, (err, res) => {
        - '    if (err) {'
        - '        console.error(err);'
        - '    }'
        - '    console.log(''Response from third embedded request:'', res.json());'
        - '});'
        - ''
        - ''
        - const request4 = {
        - '    url: `${baseUrl}/system/${sysId}/device/${hospId}/srv/prosightBypass/boundary`,'
        - '    method: ''PUT'','
        - '    header: {'
        - '        ''Content-Type'': ''application/json'''
        - '    },'
        - '    body: {'
        - '        mode: ''raw'','
        - '        modeOfBody: ''JSON'','
        - '        raw: JSON.stringify({'
        - '            boundaryId: deptBoundId,'
        - '            hospitalId: hospId,'
        - '            floorId: floorId,'
        - '            departmentId: deptId'
        - '        })'
        - '    },'
        - '    auth: {'
        - '        type: ''bearer'','
        - '        bearer: {'
        - '          token: idToken'
        - '        }'
        - '    }'
        - '};'
        - pq.sendRequest(request4, (err, res) => {
        - '    if (err) {'
        - '        console.error(err);'
        - '    }'
        - '    console.log(''Response from third embedded request:'', res.json());'
        - '});'
        - ''
type: request
