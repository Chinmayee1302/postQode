id: 5dce114b-0830-420a-b987-5b3adb1ed72a
name: step6-updateRoomId
request:
  url:
    raw: >-
      {{API_Base_URL_Dev}}/interface/{{SYSTEM_ID_Dev}}/hospital/{{AssetManagement.hopitalDetails.HospitalId}}/rooms.search
    host:
      - '{{API_Base_URL_Dev}}'
    path:
      - interface
      - '{{SYSTEM_ID_Dev}}'
      - hospital
      - '{{AssetManagement.hopitalDetails.HospitalId}}'
      - rooms.search
  method: POST
  headers:
    - key: sec-ch-ua-platform
      value: '"macOS"'
    - key: Authorization
      value: >-
        Bearer
        eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwcmoiOiI1NXptcEphMlE3dnlqdWxORjcySks2IiwiaWF0IjoxNzY0Mjc0NjYyLCJleHAiOjE3NjQzNjEwNjIsImF1ZCI6IkxvX2xuVXhGTDNadk1uRk41ZU1qRmlDVXYxeEZxRi1IIiwiaXNzIjoiaHR0cHM6Ly9kZXYtY294LWhlYWx0aC1pbWFnaW5lLWFwaS5sZXZlcmVnZS5jb20iLCJzdWIiOiI2QmE2VW1HTVZHb0R4dnhFbnVoVHFpIn0.xwrkUV6r2ApVd_mspf-ZgFx1Y3EXaPQnmuwYtJN8Pv8
    - key: Referer
      value: https://dev-cognosos.web.app/
    - key: sec-ch-ua
      value: '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"'
    - key: sec-ch-ua-mobile
      value: '?0'
    - key: User-Agent
      value: >-
        Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
        (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36
    - key: Accept
      value: application/json
    - key: Content-Type
      value: application/json
  body:
    mode: raw
    modeOfBody: JSON
    raw: |-
      {
          "limit": 100,
          "offset": 0,
          "filter": {
              "type": "logical",
              "operator": "and",
              "conditions": [
                  {
                      "type": "logical",
                      "operator": "and",
                      "conditions": [
                          {
                              "type": "equals",
                              "fieldType": "string",
                              "empty": false,
                              "field": "data/floor/name",
                              "value": [
                                  "{{AssetManagement.floorDetails.floorName}}"
                              ],
                              "floorId": "{{AssetManagement.floorDetails.floorId}}"
                          }
                      ]
                  },
                  {
                      "type": "groupedText",
                      "value": "{{AssetManagement.locationDetails.roomName_1}}"
                  }
              ]
          },
          "sort": [
              {
                  "field": "lastModified",
                  "order": "desc"
              }
          ],
          "nextToken": null
      }
  auth:
    type: bearer
    bearer:
      token: '{{idToken}}'
events:
  - listen: test
    script:
      type: javascript
      exec:
        - let res = pq.response.json();
        - // const id = response.json().items[0].id
        - pq.environment.set("AssetManagement.roomId", res.items[0].id);
        - console.log(pq.environment.get("AssetManagement.roomId"))
type: request
