id: af85f027-9598-4079-86ef-15e3ceed2dca
name: createStaff
request:
  url:
    raw: '{{API_Base_URL}}/interface/{{SYSTEM_ID}}/hospital/{{HospitalId}}/staff'
    host:
      - '{{API_Base_URL}}'
    path:
      - interface
      - '{{SYSTEM_ID}}'
      - hospital
      - '{{HospitalId}}'
      - staff
  method: POST
  headers:
    - key: sec-ch-ua-platform
      value: '"Windows"'
    - key: sec-ch-ua
      value: '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"'
    - key: sec-ch-ua-mobile
      value: '?0'
    - key: User-Agent
      value: >-
        Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,
        like Gecko) Chrome/142.0.0.0 Safari/537.36
    - key: Accept
      value: application/json
    - key: Content-Type
      value: application/json
  body:
    mode: raw
    modeOfBody: JSON
    raw: |-
      {
        "networkAliases": {
          "staff": {
            "name": "{{staffDetails.staffName}}",
            "deviceId": "{{staffDetails.staffID}}"
          }
        },
        "networkId": "staff",
        "name": "{{staffDetails.staffName}}",
        "data": [
          {
            "path": "staffType",
            "value": "{{staffDetails.staffType}}"
          },
          {
            "path": "name",
            "value": "{{staffDetails.staffName}}"
          },
          {
            "path": "staffId",
            "value": "{{staffDetails.staffID}}"
          },
          {
            "path": "assignedDepartment/id",
            "value": "{{departmentID}}"
          },
          {
            "path": "assignedDepartment/name",
            "value": "{{departmentName}}"
          },
          {
            "path": "email",
            "value": "{{staffDetails.email}}"
          }
        ]
      }
  auth:
    type: bearer
    bearer:
      token: '{{idToken}}'
events:
  - listen: test
    script:
      type: javascript
      exec:
        - "let response = pq.response.json();\r"
        - "if (pq.response.code === 200) {\r"
        - "  const staffDetails = pq.environment.get(\"staffDetails\");\r"
        - " const departmentName= pq.environment.get(\"departmentName\")\r"
        - "  pq.test(\"Validate staff details\", function () {\r"
        - "    pq.expect(response.name).to.equal(staffDetails.staffName);\r"
        - "    pq.expect(response.networkAliases.staff.deviceId).to.equal(staffDetails.staffID);\r"
        - "    pq.expect(response.data.staffType).to.equal(staffDetails.staffType);\r"
        - "    pq.expect(response.data.assignedDepartment.name).to.equal(departmentName);\r"
        - "    pq.expect(response.data.email).to.equal(staffDetails.email);\r"
        - "  });\r"
        - "  pq.environment.set(\"sId\", response.id);\r"
        - "} else {\r"
        - "  console.log(\"Staff creation failed with status code: \" + pq.response.code);\r"
        - "  console.log(response);\r"
        - "}\r"
        - ''
type: request
