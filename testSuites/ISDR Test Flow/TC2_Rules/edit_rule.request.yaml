id: c6ec4e84-42a7-41d4-aa84-70465d25d624
name: edit_rule
request:
  url:
    raw: >-
      {{API_Base_URL}}/interface/{{SYSTEM_ID}}/hospital/{{HospitalId}}.rsrc/p/rules/p/safety/p/smartRules/p/alerts/p/tagButton
    host:
      - '{{API_Base_URL}}'
    path:
      - interface
      - '{{SYSTEM_ID}}'
      - hospital
      - '{{HospitalId}}.rsrc'
      - p
      - rules
      - p
      - safety
      - p
      - smartRules
      - p
      - alerts
      - p
      - tagButton
  method: PATCH
  headers:
    - key: sec-ch-ua-platform
      value: '"Windows"'
    - key: Authorization
      value: >-
        Bearer
        eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwcmoiOiIwSDhFYW5RMEdlZmNPWVJqVjQ2d0w5IiwiaWF0IjoxNzY1OTA2MzgxLCJleHAiOjE3NjU5OTI3ODEsImF1ZCI6Ijk1NzhlMDQ2MGM5OGQ0YWRjMGY4N2Y3MCIsImlzcyI6Imh0dHBzOi8vc3RnLWNveC1oZWFsdGgtaW1hZ2luZS1hcGkubGV2ZXJlZ2UuY29tIiwic3ViIjoiMUlMdmFjNkVDQ0J4MkdFYVpVdlB4biJ9.qnIlyNpsoIsdjC3b5nGYs1hun9rTnYRqcyYFsOLeybw
    - key: Referer
      value: https://stg-cognosos.web.app/
    - key: sec-ch-ua
      value: '"Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"'
    - key: sec-ch-ua-mobile
      value: '?0'
    - key: User-Agent
      value: >-
        Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,
        like Gecko) Chrome/142.0.0.0 Safari/537.36
    - key: Accept
      value: application/json
    - key: Content-Type
      value: application/json
  body:
    mode: raw
    modeOfBody: JSON
    raw: >-
      [{"op":"replace","path":"data","value":{"type":"rule","ruleName":"{{ISDRRules.ruleName}}","ruleType":"tagButton","alertType":"staffEmergency","createdBy":"vidyashree.g@cognosos.com","isDepartmentAlerts":true,"isFloorAlerts":true}}]
events:
  - listen: test
    script:
      type: javascript
      exec:
        - "console.log(pq.request.url)\r"
        - "let response = pq.response.json()\r"
        - "if (pq.response.code === 200) {\r"
        - "  const isdrRules = pq.environment.get(\"ISDRRules\");\r"
        - "  console.log(isdrRules)\r"
        - "  pq.test(\"Validate ISDRRule details\", function () {\r"
        - "    pq.expect(response.data.ruleName).to.equal(isdrRules.ruleName);\r"
        - "    pq.expect(response.data.ruleType).to.equal(isdrRules.ruleType);\r"
        - "    pq.expect(response.data.alertType).to.equal(isdrRules.alertType);\r"
        - "    pq.expect(response.data.isFloorAlerts).to.equal(true);\r"
        - "   pq.expect(response.data.isDepartmentAlerts).to.equal(true);\r"
        - "\r"
        - "  });\r"
        - "\r"
        - "} else {\r"
        - "  console.log(pq.environment.get('isdrRules').ruleName);\r"
        - "  console.log(\"rule creation failed with status code: \" + pq.response.code);\r"
        - "  console.log(response);\r"
        - '}'
type: request
