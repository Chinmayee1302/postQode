id: 00b3f4fd-1e6e-4a21-8714-186f86fb19a2
name: AssetCreationAPI
request:
  url:
    raw: >-
      {{API_Base_URL}}/interface/{{SYSTEM_ID}}/hospital/{{AssetManagement.hospitalDetails.HospitalId}}/assets
    host:
      - '{{API_Base_URL}}'
    path:
      - interface
      - '{{SYSTEM_ID}}'
      - hospital
      - '{{AssetManagement.hospitalDetails.HospitalId}}'
      - assets
  method: POST
  headers:
    - key: Authorization
      value: >-
        Bearer
        eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwcmoiOiIwSDhFYW5RMEdlZmNPWVJqVjQ2d0w5IiwiaWF0IjoxNzYwNDEyNTU5LCJleHAiOjE3NjA0OTg5NTksImF1ZCI6Ijk1NzhlMDQ2MGM5OGQ0YWRjMGY4N2Y3MCIsImlzcyI6Imh0dHBzOi8vc3RnLWNveC1oZWFsdGgtaW1hZ2luZS1hcGkubGV2ZXJlZ2UuY29tIiwic3ViIjoiMDlzWjgwV3kxd25qQ1QwYWtZaFgxeSJ9.7sAqhSSZV28-HaiXJXDHdab_yYO5gjKFWRbttNr6sQ4
    - key: Content-Type
      value: application/json
  body:
    mode: raw
    modeOfBody: JSON
    raw: |-
      {
          "networkAliases": {
              "assets": {
                  "deviceId": "{{deviceId}}",
                  "name": "{{assetName}}"
              }
          },
          "networkId": "assets",
          "name": "{{assetName}}",
          "data": [
              {
                  "path": "assetId",
                  "value": "{{AssetManagement.asset2.assetId}}"
              },
              {
                  "path": "assetType",
                  "value": "{{AssetManagement.asset2.assetType}}"
              },
              {
                  "path": "assignedDepartment/id",
                  "value": "{{AssetManagement.departmentID}}"
              },
              {
                  "path": "assignedDepartment/name",
                  "value": "{{AssetManagement.departmentName}}"
              },
              {
                  "path": "isRental",
                  "value": true
              },
              {
                  "path": "maintenance/nextPreventativeMaintenanceDate",
                  "value": null
              },
              {
                  "path": "maintenance/preventativeMaintenanceInterval",
                  "value": null
              },
              {
                  "path": "maintenance/preventativeMaintenanceIntervalDueDate",
                  "value": null
              },
              {
                  "path": "manufacturer"
              },
              {
                  "path": "manufacturerPrice",
                  "value": null
              },
              {
                  "path": "modelNumber"
              },
              {
                  "path": "name",
                  "value": "{{assetName}}"
              },
              {
                  "path": "rentalDueDate",
                  "value": {{rentalDueDate}}
              },
              {
                  "path": "rentedDate",
                  "value": {{rentalDate}}
              },
              {
                  "path": "serialNumber",
                  "value": "{{AssetManagement.asset2.serialNumber}}"
              },
              {
                  "path": "status/operational",
                  "value": true
              },
              {
                  "path": "status/available",
                  "value": false
              },
              {
                  "path": "status/cleaningRequired",
                  "value": false
              },
              {
                  "path": "status/maintenanceRequired",
                  "value": false
              },
              {
                  "path": "status/inMaintenance",
                  "value": false
              },
              {
                  "path": "status/missing",
                  "value": false
              },
              {
                  "path": "status/outOfCirculation",
                  "value": false
              },
              {
                  "path": "maintenance/preventativeMaintenanceIntervalDueDate",
                  "value": null
              }
          ]
      }
  auth:
    type: bearer
    bearer:
      token: '{{idToken}}'
events:
  - listen: prerequest
    script:
      type: javascript
      exec:
        - "pq.variables.set(\"rentalDate\", Date.now() - 14 * 24 * 60 * 60 * 1000);\r"
        - "pq.variables.set(\"rentalDueDate\", Date.now());\r"
        - "\r"
        - "const baseName = pq.environment.get(\"AssetManagement.asset2.assetName\"); // static from YAML\r"
        - "const randomInt = Math.floor(Math.random() * 900) + 100;\r"
        - "\r"
        - "const finalName = `${baseName}${randomInt}`;\r"
        - "pq.variables.set(\"assetName\", finalName);\r"
        - "\r"
        - "const deviceId = pq.environment.get(\"AssetManagement.tagDetails.tag2.deviceId\"); \r"
        - "\r"
        - "\r"
        - "const finaldeviceId = `${deviceId}${randomInt}`;\r"
        - "pq.variables.set(\"deviceId\", finaldeviceId);\r"
        - "\r"
        - "\r"
        - "\r"
        - "\r"
        - "\r"
        - "\r"
        - ''
  - listen: test
    script:
      type: javascript
      exec:
        - const response=pq.response.json()
        - >-
          pq.environment.set("AssetManagement.rulesData.availableruleName.assetDetails.assetlevId",
          response.id)
        - setTimeout(() => {
        - '  console.log("wait for 10 secs")'
        - '},4000)'
type: request
