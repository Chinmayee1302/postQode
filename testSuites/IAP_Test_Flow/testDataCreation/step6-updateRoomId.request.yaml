id: 5dce114b-0830-420a-b987-5b3adb1ed72f
name: step6-updateRoomId
request:
  url:
    raw: >-
      {{API_Base_URL}}/interface/{{SYSTEM_ID}}/hospital/{{AssetManagement.hospitalDetails.HospitalId}}/rooms.search
    host:
    - '{{API_Base_URL}}'
    path:
    - interface
    - '{{SYSTEM_ID}}'
    - hospital
    - '{{AssetManagement.hospitalDetails.HospitalId}}'
    - rooms.search
  method: POST
  headers:
  - key: Content-Type
    value: application/json
  body:
    mode: raw
    modeOfBody: JSON
    raw: |-
      {
          "limit": 100,
          "offset": 0,
          "filter": {
              "type": "logical",
              "operator": "and",
              "conditions": [
                  {
                      "type": "equals",
                      "field": "data.parentData.floor.id",
                      "value": "{{AssetManagement.floorDetails.floorId}}",
                      "fieldType": "string"
                  }
              ]
          },
          "sort": [
              {
                  "field": "lastModified",
                  "order": "desc"
              }
          ],
          "nextToken": null
      }
  auth:
    type: bearer
    bearer:
      token: '{{idToken}}'
events:
- listen: test
  script:
    type: javascript
    exec:
    - let res = pq.response.json();
    - // const id = response.json().items[0].id
    - pq.environment.set("AssetManagement.roomId", res.items[0].id);
    - console.log(pq.environment.get("AssetManagement.roomId"))
type: request
