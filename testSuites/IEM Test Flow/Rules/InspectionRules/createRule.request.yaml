id: 4a15bfaa-6cf2-473e-aa40-f33202f87e87
name: createRule
request:
  url:
    raw: >-
      {{API_Base_URL}}/interface/{{SYSTEM_ID}}/hospital/{{EquipmentManagement.hospitalDetails.hospitalId}}/equipment/{{EquipmentManagement.equipmentDetails.equipment3.equipmentId}}
    host:
      - '{{API_Base_URL}}'
    path:
      - interface
      - '{{SYSTEM_ID}}'
      - hospital
      - '{{EquipmentManagement.hospitalDetails.hospitalId}}'
      - equipment
      - '{{EquipmentManagement.equipmentDetails.equipment3.equipmentId}}'
  method: PATCH
  headers:
    - key: sec-ch-ua-platform
      value: '"Windows"'
    - key: Authorization
      value: Bearer {{idToken}}
    - key: Referer
      value: https://dev-cognosos.web.app/
    - key: sec-ch-ua
      value: '"Google Chrome";v="143", "Chromium";v="143", "Not A(Brand";v="24"'
    - key: sec-ch-ua-mobile
      value: '?0'
    - key: User-Agent
      value: >-
        Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,
        like Gecko) Chrome/143.0.0.0 Safari/537.36
    - key: Accept
      value: application/json
    - key: Content-Type
      value: application/json
  body:
    mode: raw
    modeOfBody: JSON
    raw: |-
      {
          "data": [
              {
                  "path": "rule/lastModified",
                  "value": "{{Rules.inspectionRuleDetails.lastModified}}"
              },
              {
                  "path": "inspectionRule/autoInspection",
                  "value": "{{Rules.inspectionRuleDetails.autoInspect}}"
              },
              {
                  "path": "inspectionRule/frequency",
                  "value": "{{Rules.inspectionRuleDetails.frequency}}"
              },
              {
                  "path": "inspectionRule/firstInspectionTime",
                  "value":"{{Rules.inspectionRuleDetails.firstInspectionTime}}"
              },
              {
                  "path": "inspectionRule/firstInspectionUTC",
                  "value": {
                      "hour": 18,
                      "minute": 30,
                      "day": 0,
                      "date": 14
                  }
              },
              {
                  "path": "secondInspection",
                  "value": "{{Rules.inspectionRuleDetails.secondInspection}}"
              },
              {
                  "path": "inspectionRule/secondInspectionTime",
                  "value": 1765747819221
              },
              {
                  "path": "inspectionRule/secondInspectionUTC",
                  "value": {
                      "hour": 21,
                      "minute": 30,
                      "day": 0,
                      "date": 14
                  }
              },
              {
                  "path": "inspectionRule/firstInspectionDay",
                  "value": "{{Rules.inspectionRuleDetails.secondInspectionTime}}"
              },
              {
                  "path": "inspectionRule/secondInspectionDay",
                  "value": 1765747819221
              }
          ]
      }
events:
  - listen: prerequest
    script:
      type: javascript
      exec:
        - "function timeToDate(timeStr) {\r"
        - "    const now = new Date();\r"
        - "\r"
        - "    const [time, meridian] = timeStr.split(\" \");\r"
        - "    let [hour, minute] = time.split(\":\").map(Number);\r"
        - "\r"
        - "    if (meridian === \"PM\" && hour !== 12) hour += 12;\r"
        - "    if (meridian === \"AM\" && hour === 12) hour = 0;\r"
        - "\r"
        - "    now.setHours(hour, minute, 0, 0);\r"
        - "    return now;\r"
        - "}\r"
        - "\r"
        - "function toUTCObject(date) {\r"
        - "    return {\r"
        - "        hour: date.getUTCHours(),\r"
        - "        minute: date.getUTCMinutes(),\r"
        - "        day: date.getUTCDay(),\r"
        - "        date: date.getUTCDate()\r"
        - "    };\r"
        - "}\r"
        - "\r"
        - "const env = pq.environment;\r"
        - "\r"
        - "// ---- First Inspection ----\r"
        - "const firstTimeStr = env.get(\"Rules.inspectionRuleDetails.firstInspectionTime\");\r"
        - "const firstDate = timeToDate(firstTimeStr);\r"
        - "\r"
        - "env.set(\"Rules.inspectionRuleDetails.firstInspectionTimestamp\", firstDate.getTime());\r"
        - "env.set(\r"
        - "  \"Rules.inspectionRuleDetails.firstInspectionUTC\",\r"
        - "  JSON.stringify(toUTCObject(firstDate))\r"
        - ");\r"
        - "\r"
        - "// ---- Second Inspection ----\r"
        - "const secondTimeStr = env.get(\"Rules.inspectionRuleDetails.secondInspectionTime\");\r"
        - "const secondDate = timeToDate(secondTimeStr);\r"
        - "\r"
        - "env.set(\"Rules.inspectionRuleDetails.secondInspectionTimestamp\", secondDate.getTime());\r"
        - "env.set(\r"
        - "  \"Rules.inspectionRuleDetails.secondInspectionUTC\",\r"
        - "  JSON.stringify(toUTCObject(secondDate))\r"
        - ");\r"
        - "\r"
        - "// ---- Last Modified (current time) ----\r"
        - "pq.environment.set('Rules.inspectionRuleDetails.lastModified', Date.now());\r"
        - ''
type: request
